List<FieloEE__Banner__c> banners = [SELECT Id, (SELECT FieloEE__Segment__c FROM FieloEE__SegmentDomain__r) FROM FieloEE__Banner__c WHERE Id = 'aA7120000004CaB'];
List<FieloEE__SegmentDomain__c> domainsToDelete = new List<FieloEE__SegmentDomain__c>();

for(FieloEE__Banner__c banner : banners){
    banner.FieloEE__HasSegments__c = banner.FieloEE__SegmentDomain__r.size() > 1;
    if(banner.FieloEE__SegmentDomain__r.size() == 1){
        banner.FieloEE__RedemptionRule__c = banner.FieloEE__SegmentDomain__r[0].FieloEE__Segment__c;
        domainsToDelete.add(banner.FieloEE__SegmentDomain__r);        
    }
}

update banners;
delete domainsToDelete;











List<FieloEE__Banner__c> banners = [SELECT Id, (SELECT FieloEE__Segment__c FROM FieloEE__SegmentDomain__r) FROM FieloEE__Banner__c];
List<FieloEE__News__c> news = [SELECT Id, (SELECT FieloEE__Segment__c FROM FieloEE__SegmentDomain__r) FROM FieloEE__News__c];
List<FieloEE__Reward__c> rewards = [SELECT Id, (SELECT FieloEE__Segment__c FROM FieloEE__SegmentDomain__r) FROM FieloEE__Reward__c];
List<FieloEE__SegmentDomain__c> domainsToDelete = new List<FieloEE__SegmentDomain__c>();

for(FieloEE__Banner__c banner : banners){
    banner.FieloEE__HasSegments__c = banner.FieloEE__SegmentDomain__r.size() > 1;
    if(banner.FieloEE__SegmentDomain__r.size() == 1){
        banner.FieloEE__RedemptionRule__c = banner.FieloEE__SegmentDomain__r[0].FieloEE__Segment__c;
        domainsToDelete.add(banner.FieloEE__SegmentDomain__r);
    }else{
        banner.FieloEE__RedemptionRule__c = null;
    }
}

for(FieloEE__News__c newsRecord : news){
    newsRecord.FieloEE__HasSegments__c = newsRecord.FieloEE__SegmentDomain__r.size() > 1;
    if(newsRecord.FieloEE__SegmentDomain__r.size() == 1){
        newsRecord.FieloEE__RedemptionRule__c = newsRecord.FieloEE__SegmentDomain__r[0].FieloEE__Segment__c;
        domainsToDelete.add(newsRecord.FieloEE__SegmentDomain__r);
        newsToUpdate.add(newsRecord);
    }else{
        banner.FieloEE__RedemptionRule__c = null;
    }
}

for(FieloEE__Reward__c reward : rewards){
    reward.FieloEE__HasSegments__c = reward.FieloEE__SegmentDomain__r.size() > 1;
    if(reward.FieloEE__SegmentDomain__r.size() == 1){
        reward.FieloEE__RedemptionRule__c = reward.FieloEE__SegmentDomain__r[0].FieloEE__Segment__c;
        domainsToDelete.add(reward.FieloEE__SegmentDomain__r);
        rewardsToUpdate.add(reward);
    }else{
        banner.FieloEE__RedemptionRule__c = null;
    }
}

update banners;
update news;
update rewards;
delete domainsToDelete;